"use strict";function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,r){var t=[],n=!0,i=!1,a=void 0;try{for(var l,s=e[Symbol.iterator]();!(n=(l=s.next()).done)&&(t.push(l.value),!r||t.length!==r);n=!0);}catch(e){i=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return t}function _arrayWithHoles(e){if(Array.isArray(e))return e}!function(){var o={fieldDefault:[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],defaultShips:[4,3,3,2,2,2,1,1,1,1],enemyName:["Капитан Немо","Капитан Джэк Воробей","Гектор Барбосса","Черная Борода","Капитан Америка","Капитан Крюк","Капитан Очевидность"],shipsName:["Весёлый Роджер","Дункан","Испаньола","Наутилус","Титаник","Крейсер Аврора","Летучий Голландец","Каравелла Колумба","Черная Жемчужина","Разящий","Перехватчик","Тихая Мэри","Месть королевы Анны","Летающий дракон","Фрегат Авраам Линкольн","Корабль Её Величества «Пинафор»","Королевская удача","Линкор «Ямато»","Линкор «Бисмарк»","Крейсер «Петр Великий»"],userHurtText:["Капитан, мы сломали им мачту на корабле","Капитан, разрешите доложить, попали точно в цель","Мы подбили их корабль","Капитан, наши пушки разорвали им корпус",'Капитан, мы из рогатки попали в "Бердянск"'],enemyHurtText:["Капитан, в нас попали","Капитан, вражеская торпеда нанесла нам серьезный урок","Капитан, нам пробили корпус, чем будем отвечеть?","Капитан, течь на корабле, спасайтесь!!!"],enemyWin:["А кто то сомневался?","Йо-хо-хо и бутылка рома!","Миссия выполнена, теперь я отправляюсь за сундуком Дейви Джонса","Теперь Вы готовы сдаться?"],enemyLose:["Но Крым я Вам все равно не отдам","Капитан пощади, у меня 10 детей, 20 внуков, их всех надо кормить","Давайте жить дружно...","Я еще отыграюсь","И на моей улице перевернется камаз с ромом!","Может ты и потопил весь мой флот, но сам я не сдамся","Какой ты опытный капитан, пойдешь в мою команду?"]},v=function(e,r){var t=e-.5+Math.random()*(r-e+1);return t=Math.round(t)},s=function(e){for(var r=0;r<e.length;r++)for(var t=0;t<e.length;t++)r!==t&&e[r][0]===e[t][0]&&e[r][1]===e[t][1]&&e.slice(t,1);return e},p=function(e,r,t){var n=document.createElement("P");switch(t){case 1:n.classList.add("app__print","app__print--user");break;case 2:n.classList.add("app__print","app__print--enemy");break;case 3:n.classList.add("app__print","app__print--info")}e.firstElementChild?e.insertBefore(n,e.firstElementChild):e.appendChild(n);var i=r.split(""),a=setInterval(function(){if(!i[0])return clearInterval(a);n.innerHTML+=i.shift()},40);if(20<e.childNodes.length)for(;20<e.childNodes.length;)e.removeChild(e.lastElementChild)},l=function(e,r){var t,n,i=[];if(0===e){t=v(0,9),n=v(0+r-1,9);for(var a=0;a<r;a++)i.push([t,n-a]);return i}if(1===e){t=v(0,9-r+1),n=v(0,9);for(var l=0;l<r;l++)i.push([t+l,n]);return i}if(2===e){t=v(0,9),n=v(0,9-r+1);for(var s=0;s<r;s++)i.push([t,n+s]);return i}t=v(0+r-1,9),n=v(0,9);for(var o=0;o<r;o++)i.push([t-o,n]);return i},c=function(e){for(var r=e.slice(),t=0;t<e.length;t++)for(var n=e[t][0],i=e[t][1],a=[[n,i-1],[n+1,i-1],[n+1,i],[n+1,i+1],[n,i+1],[n-1,i+1],[n-1,i],[n-1,i-1]],l=0;l<a.length;l++)a[l][0]<10&&0<=a[l][0]&&a[l][1]<10&&0<=a[l][1]&&r.push(a[l]);return r=s(r)},f=function(e,r){for(var t=!1,n=0;n<e.length;n++){var i=e[n][0],a=e[n][1];r[a][i]<=4&&1<=r[a][i]&&(t=!0)}return t},u=function(e,r){for(var t=0;t<r.length;t++){var n=r[t][0];e[r[t][1]][n]=r.length}};function e(e){for(var r=0;r<o.defaultShips.length;r++){for(var t=o.defaultShips[r],n=void 0,i=void 0,a=void 0;n=v(0,3),i=l(n,t),a=c(i),f(a,e););u(e,i)}return e}function a(e,r){for(var t=0;t<e.length;t++)for(var n=0;n<e.length;n++){var i=e[t][n];if(i<=5&&1<=i)r.querySelectorAll(".app__row")[t].querySelectorAll(".app__cell")[n].classList.add("app__ship")}}var d={getShipsDead:function(e,r,t){var n,i=!0,a=r;for(n=--a<0?6:t[a][e];n&&0!==n&&6!==n;)n<=4&&1<=n&&(i=!1),n=--a<0?6:t[a][e];var l=e;for(n=t[r][++l]||6;n&&0!==n&&6!==n;)n<=4&&1<=n&&(i=!1),n=t[r][++l]||6;for(a=r,n=9<++a?6:t[a][e];n&&0!==n&&6!==n;)n<=4&&1<=n&&(i=!1),n=9<++a?6:t[a][e];for(l=e,n=t[r][--l]||6;n&&0!==n&&6!==n;)n<=4&&1<=n&&(i=!1),n=t[r][--l]||6;return i},paintNearCells:function(e,r,t,n){for(var i=[[e,r-1],[e+1,r-1],[e+1,r],[e+1,r+1],[e,r+1],[e-1,r+1],[e-1,r],[e-1,r-1]],a=0;a<i.length;a++){var l=i[a][0],s=i[a][1],o=void 0;6!==(o=s<0||9<s?5:t[s][l])&&0!==o||(o=6,n.querySelectorAll(".app__row")[s].querySelectorAll(".app__cell")[l].classList.add("app__miss"))}},paintAndAdd:function(e,r,t,n){this.paintNearCells(e,r,t,n);var i,a=r;for(i=--a<0?6:t[a][e];5===i;)this.paintNearCells(e,a,t,n),i=--a<0?6:t[a][e];var l=e;for(i=t[r][++l]||6;5===i;)this.paintNearCells(l,r,t,n),i=t[r][++l]||6;for(a=r,i=9<++a?6:t[a][e];5===i;)this.paintNearCells(e,a,t,n),i=9<++a?6:t[a][e];for(l=e,i=t[r][--l]||6;5===i;)this.paintNearCells(l,r,t,n),i=t[r][--l]||6},clearHtml:function(){for(var e=document.querySelector("#fields"),r=e.querySelectorAll(".app__hard"),t=e.querySelectorAll(".app__miss"),n=e.querySelectorAll(".app__ship"),i=0;i<r.length;i++)r[i].classList.remove("app__hard");for(var a=0;a<t.length;a++)t[a].classList.remove("app__miss");for(var l=0;l<n.length;l++)n[l].classList.remove("app__ship")},clearConsole:function(e){for(;e.firstElementChild;)e.removeChild(e.firstElementChild)},paintAllCellsPoint:function(e){for(var r=e.querySelectorAll(".app__cell"),t=0;t<r.length;t++)r[t].classList.contains("app__miss")||r[t].classList.contains("app__ship")||r[t].classList.add("app__miss")}},m=function(e,r,t,n){var i=_slicedToArray(function(e,r){if(-1!==e.positionEnemy[0][0]&&1===e.positionEnemy.length){var t=e.positionEnemy[0][0],n=e.positionEnemy[0][1];if(0<=n-1&&r[n-1][t]<5)return[t,n-1];if(t+1<10&&r[n][t+1]<5)return[t+1,n];if(n+1<10&&r[n+1][t]<5)return[t,n+1];if(0<=t-1&&r[n][t-1]<5)return[t-1,n]}if(-1!==e.positionEnemy[0][0]&&1!==e.positionEnemy.length){var i=e.positionEnemy[0][0],a=e.positionEnemy[0][1],l=e.positionEnemy[1][0],s=e.positionEnemy[1][1];if(i===l){for(var o=[],p=0;p<e.positionEnemy.length;p++)o.push(e.positionEnemy[p][1]);var c=Math.max.apply(null,o),f=Math.min.apply(null,o);if(c+1<10&&r[c+1][i]<5)return[i,c+1];if(0<=f-1&&r[f-1][i]<5)return[i,f-1]}if(a===s){for(var u=[],d=0;d<e.positionEnemy.length;d++)u.push(e.positionEnemy[d][0]);var m=Math.max.apply(null,u),h=Math.min.apply(null,u);if(m+1<10&&r[a][m+1]<5)return[m+1,a];if(0<=h-1&&r[a][h-1]<5)return[h-1,a]}}var y,_;if(v(1,10)>=e.hard)for(;y=v(0,9),4<r[_=v(0,9)][y];);else for(;y=v(0,9),4<r[_=v(0,9)][y]||r[_][y]<1;);return[y,_]}(e,e.fieldUser),2),a=i[0],l=i[1],s=r.querySelectorAll(".app__row")[l].querySelectorAll(".app__cell")[a];e.fieldUser[l][a]<=4&&1<=e.fieldUser[l][a]?(e.fieldUser[l][a]=5,s.classList.add("app__hard"),d.getShipsDead(a,l,e.fieldUser)?(p(t,"".concat(e.enemyName," потопил Ваш корабль:  ").concat(e.shipsName.pop()),2),d.paintAndAdd(a,l,e.fieldUser,r),e.positionEnemy=[[-1,-1]],--e.shipsUserNumber,1<=e.shipsUserNumber?e.flagUser=!1:e.flagUser=!0):(p(t,o.enemyHurtText[v(0,o.enemyHurtText.length-1)],2),e.flagUser=!1,-1===e.positionEnemy[0][0]?e.positionEnemy.splice(0,1,[a,l]):e.positionEnemy.push([a,l]))):0===e.fieldUser[l][a]&&(p(t,"".concat(e.enemyName," промахнулся - ваш ход"),2),n.classList.add("app__field--active"),e.fieldUser[l][a]=6,s.classList.add("app__miss"),e.flagUser=!0)};function i(r,t,n,i){setTimeout(function e(){m(r,t,n,i),0===r.shipsUserNumber?(r.flagUser=!1,d.paintAllCellsPoint(t),p(n,"Вы проиграли",3),p(n,"".concat(r.enemyName,":  ").concat(o.enemyWin[v(0,o.enemyWin.length-1)]),3),a(r.fieldEnemy,i)):r.flagUser||setTimeout(e,v(500,1500))},1e3)}var h,r,y=document.querySelector("#info"),_=document.querySelector(".app__field--user"),g=document.querySelector(".app__field--enemy"),t=document.querySelector(".app__poppup"),n=document.querySelector("#name");g.addEventListener("click",function(e){if(h.flagUser){var r=e.target,t=+r.dataset.cell,n=+r.parentElement.dataset.row;if(h.fieldEnemy[n][t]<=4&&1<=h.fieldEnemy[n][t])h.fieldEnemy[n][t]=5,r.classList.add("app__hard"),d.getShipsDead(t,n,h.fieldEnemy)?(p(y,"Вы потопили корабль: ".concat(h.shipsName.pop()),1),d.paintAndAdd(t,n,h.fieldEnemy,g),--h.shipsEnemyNumber,0===h.shipsEnemyNumber&&(h.flagUser=!1,a(h.fieldEnemy,g),p(y,"Конец игры, Вы выйграли",3),p(y,"".concat(h.enemyName,":  ").concat(o.enemyLose[v(0,o.enemyLose.length-1)]),3),d.paintAllCellsPoint(g))):p(y,o.userHurtText[v(0,o.userHurtText.length-1)],1);else 0===h.fieldEnemy[n][t]&&(p(y,"Вы промахнулись - ходит ".concat(h.enemyName),1),g.classList.remove("app__field--active"),h.flagUser=!1,h.fieldEnemy[n][t]=6,r.classList.add("app__miss"),i(h,_,y,g))}});var E=document.querySelector("#new");E.addEventListener("click",function(){switch(document.querySelector(".app__user").textContent=n.value||"Неизвестный игрок",n.value="",t.classList.add("app__hidden"),document.querySelector('input[type="radio"]:checked').id){case"easy":r=0;break;case"middle":r=3;break;case"heavy":r=5}d.clearHtml(),d.clearConsole(y),a((h={fieldUser:e(JSON.parse(JSON.stringify(o.fieldDefault))),fieldEnemy:e(JSON.parse(JSON.stringify(o.fieldDefault))),shipsUserNumber:o.defaultShips.length,shipsEnemyNumber:o.defaultShips.length,enemyName:o.enemyName[v(0,o.enemyName.length-1)],shipsName:o.shipsName.slice().sort(function(){return Math.random()-.5}),flagUser:!1,hard:r||0,positionEnemy:[[-1,-1]],number:v(0,1)}).fieldUser,_),document.querySelector(".app__enemy").textContent=h.enemyName,0===h.number?(h.flagUser=!0,g.classList.add("app__field--active"),p(y,"Первым ходите Вы",3)):(p(y,"Первым ходит ".concat(h.enemyName),3),i(h,_,y,g))}),n.addEventListener("keypress",function(e){13===e.keyCode&&E.click()}),document.querySelector("#restart").addEventListener("click",function(){t.classList.remove("app__hidden")})}();